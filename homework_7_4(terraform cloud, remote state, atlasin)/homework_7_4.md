## Домашнее задание к занятию "7.4. Средства командной работы над инфраструктурой."
___
**Задача 1. Настроить terraform cloud (необязательно, но крайне желательно).**

В это задании предлагается познакомиться со средством командой работы над инфраструктурой предоставляемым разработчиками терраформа.

1. Зарегистрируйтесь на https://app.terraform.io/. (регистрация бесплатная и не требует использования платежных инструментов).
2. Создайте в своем github аккаунте (или другом хранилище репозиториев) отдельный репозиторий с конфигурационными файлами прошлых занятий (или воспользуйтесь любым простым конфигом).
3. Зарегистрируйте этот репозиторий в https://app.terraform.io/.
4. Выполните `plan` и `apply`.

В качестве результата задания приложите снимок экрана с успешным применением конфигурации.
___
**Выполнение ДЗ:**

1. Регистрация

2. Добавление аккаунта github с новым репозиторием

3. Регистрация репозитория в app.terraform.io

4. Создание плана



Вопросы:

1. Как добавить несколько воркспейсов, аналогично `terraform workspace new stage` и `terraform workspace new prod`?

Использовал файл `main.tf` из предыдущего ДЗ. Там использовалось несколько воркспейсов и при запуске плана в terraform cloud появляется ошибка:

      Terraform v1.0.5
      on linux_amd64
      Configuring remote state backend...
      Initializing Terraform configuration...
      ╷
      │ Error: Invalid index
      │ 
      │   on main.tf line 45, in resource "aws_instance" "test":
      │   45:   instance_type = local.web_instance_type_map[terraform.workspace]
      │     ├────────────────
      │     │ local.web_instance_type_map is object with 2 attributes
      │     │ terraform.workspace is "default"
      │ 
      │ The given key does not identify an element in this collection value.
      ╵
      ╷
      │ Error: Invalid index
      │ 
      │   on main.tf line 46, in resource "aws_instance" "test":
      │   46:   count = local.web_instance_count_map[terraform.workspace]
      │     ├────────────────
      │     │ local.web_instance_count_map is object with 2 attributes
      │     │ terraform.workspace is "default"
      │ 
      │ The given key does not identify an element in this collection value.

То есть в Cloud используется по умолчанию default воркспейс. Соответственно, данный конфиг не запустится пока не пропишешь эти воркспейсы.

Или используя Cloud тут подход другой будет? Если да, то как правильно решить такую задачу? (допустим, эти файлы конфигурации были использованы локально, а сейчас мы переходим на terraform cloud и они не запускаются)

2. Почему не добавляется файл стейта в S3? В конфигурационном файле следующий блок присутствует:
         
              terraform {
               backend "s3" {
                 bucket         = "terraform-test-netology"
                 encrypt        = true
                 key            = "netology/terraform.tfstate"
                 region         = "eu-west-2"
                 dynamodb_table = "terraform-locks"
               }
              }

Или Terraform Cloud хранит стейт файлы со своей стороны? Если так, то получается добавлять бэкэнд в S3 или иное место смысла нет в файл `main.tf`?

Сам инстанс создается успешно

3.
___
**Задача 2. Написать серверный конфиг для атлантиса.**

Смысл задания – познакомиться с документацией о серверной конфигурации и конфигурации уровня репозитория.

Создай `server.yaml` который скажет атлантису:

1. Укажите, что атлантис должен работать только для репозиториев в вашем github (или любом другом) аккаунте.
2. На стороне клиентского конфига разрешите изменять `workflow`, то есть для каждого репозитория можно будет указать свои дополнительные команды.
3. В` workflow` используемом по-умолчанию сделайте так, что бы во время планирования не происходил `lock `состояния.

Создай `atlantis.yaml` который, если поместить в корень terraform проекта, скажет атлантису:

1. Надо запускать планирование и аплай для двух воркспейсов `stage `и `prod`.
2. Необходимо включить автопланирование при изменении любых файлов `*.tf`.

В качестве результата приложите ссылку на файлы `server.yaml` и `atlantis.yaml`.
___
**Выполнение ДЗ:**



___
**Задача 3. Знакомство с каталогом модулей.**

1. В каталоге модулей найдите официальный модуль от aws для создания `ec2 `инстансов.
2. Изучите как устроен модуль. Задумайтесь, будете ли в своем проекте использовать этот модуль или 
   непосредственно ресурс `aws_instance` без помощи модуля?
3. В рамках предпоследнего задания был создан ec2 при помощи ресурса `aws_instance`. Создайте аналогичный инстанс при помощи найденного модуля.

В качестве результата задания приложите ссылку на созданный блок конфигураций.
___
**Выполнение ДЗ:**

